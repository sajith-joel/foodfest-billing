<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Food Fest Billing - IT Stall</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    padding:10px;
    background: linear-gradient(135deg,#ffecd2,#fcb69f);
}

h1{text-align:center;}

.info{
    text-align:center;
    font-size:14px;
}

.items{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:10px;
    margin-top:10px;
}

.item{
    background:white;
    border-radius:15px;
    padding:6px;
    text-align:center;
    box-shadow:0 5px 10px rgba(0,0,0,0.15);
    cursor:pointer;
    transition:0.2s ease;
}

.item:hover{transform:scale(1.05);}
.item:active{transform:scale(0.95);}

.item img{
    width:100%;
    height:80px;
    object-fit:cover;
    border-radius:10px;
}

.cart{
    margin-top:15px;
    background:white;
    padding:12px;
    border-radius:15px;
    box-shadow:0 5px 10px rgba(0,0,0,0.2);
}

.cart-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:6px;
    font-size:14px;
}

.qty-btn,.remove-btn{
    border:none;
    padding:4px 8px;
    border-radius:6px;
    margin:0 2px;
    color:white;
}

.qty-btn{background:orange;}
.remove-btn{background:red;}

.green-btn,.red-btn{
    border:none;
    padding:10px;
    width:100%;
    border-radius:8px;
    margin-top:8px;
    font-size:16px;
    color:white;
}

.green-btn{background:green;}
.red-btn{background:red;}

input{
    width:100%;
    padding:8px;
    font-size:16px;
    margin-top:5px;
    border-radius:6px;
    border:1px solid gray;
}
</style>
</head>

<body>

<h1>üçπ IT-Stall</h1>

<div class="info">
Bill No: <span id="billNo">1</span><br>
<span id="dateTime"></span>
</div>

<div class="items" id="itemList"></div>

<div class="cart">
<h3>üõí Cart</h3>
<div id="cartItems"></div>

<h3>Total: ‚Çπ<span id="total">0</span></h3>

<label>Amount Given:</label>
<input type="number" id="paid" oninput="calculateBalance()">

<h3>Balance: ‚Çπ<span id="balance">0</span></h3>

<h3>Today's Sales: ‚Çπ<span id="dailyTotal">0</span></h3>

<button class="green-btn" onclick="completeSale()">Complete Sale</button>
<button class="red-btn" onclick="resetCart()">Cancel</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDly_TTlTpVxnE7REoD9HKz6zi3BxrMRzU",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "YOUR_DATABASE_URL",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

window.database = database;
window.ref = ref;
window.push = push;
window.set = set;
</script>

<script>

const items = [
{name:"Bun", price:20, image:"https://via.placeholder.com/150"},
{name:"Pani Puri", price:30, image:"https://via.placeholder.com/150"},
{name:"Full Jar Soda", price:50, image:"https://via.placeholder.com/150"},
{name:"Lime Juice", price:25, image:"https://via.placeholder.com/150"},
{name:"Lime Soda", price:30, image:"https://via.placeholder.com/150"},
{name:"Mojito", price:40, image:"https://via.placeholder.com/150"},
{name:"Aval Milk", price:35, image:"https://via.placeholder.com/150"},
{name:"Coconut Shake", price:45, image:"https://via.placeholder.com/150"}
];

let cart = {};
let total = 0;
let billNo = 1;
let dailyTotal = Number(localStorage.getItem("dailyTotal")) || 0;

document.getElementById("dailyTotal").innerText = dailyTotal;

function loadItems(){
    let html="";
    items.forEach(item=>{
        html+=`
        <div class="item" onclick="addItem('${item.name}',${item.price})">
            <img src="${item.image}">
            <p>${item.name} ‚Çπ${item.price}</p>
        </div>`;
    });
    document.getElementById("itemList").innerHTML=html;
}

function addItem(name,price){
    if(cart[name]){
        cart[name].qty++;
    }else{
        cart[name]={price:price,qty:1};
    }
    total+=price;
    updateCart();
}

function updateCart(){
    let html="";
    for(let item in cart){
        html+=`
        <div class="cart-item">
            ${item} x ${cart[item].qty}
            <div>
                <button class="qty-btn" onclick="changeQty('${item}',-1)">-</button>
                <button class="qty-btn" onclick="changeQty('${item}',1)">+</button>
                <button class="remove-btn" onclick="removeItem('${item}')">X</button>
            </div>
        </div>`;
    }
    document.getElementById("cartItems").innerHTML=html;
    document.getElementById("total").innerText=total;
}

function changeQty(name,change){
    cart[name].qty+=change;
    total+=cart[name].price*change;
    if(cart[name].qty<=0){
        delete cart[name];
    }
    updateCart();
}

function removeItem(name){
    total-=cart[name].price*cart[name].qty;
    delete cart[name];
    updateCart();
}

function calculateBalance(){
    let paid = Number(document.getElementById("paid").value) || 0;
    let balance = paid - total;
    document.getElementById("balance").innerText = balance >= 0 ? balance : 0;
}

function completeSale(){
    if(total === 0){
        alert("Cart is empty!");
        return;
    }

    const paidAmount = Number(document.getElementById("paid").value) || 0;

    if(paidAmount < total){
        alert("Insufficient payment!");
        return;
    }

    const orderData = {
        billNo: billNo,
        items: cart,
        total: total,
        paid: paidAmount,
        balance: paidAmount - total,
        time: new Date().toLocaleString()
    };

    const ordersRef = window.ref(window.database, "orders");
    const newOrderRef = window.push(ordersRef);
    window.set(newOrderRef, orderData);

    dailyTotal += total;
    localStorage.setItem("dailyTotal", dailyTotal);
    document.getElementById("dailyTotal").innerText = dailyTotal;

    billNo++;
    document.getElementById("billNo").innerText = billNo;

    alert("Sale Completed & Saved!");

    resetCart();
}

function resetCart(){
    cart={};
    total=0;
    document.getElementById("cartItems").innerHTML="";
    document.getElementById("total").innerText=0;
    document.getElementById("paid").value="";
    document.getElementById("balance").innerText=0;
}

function updateDateTime(){
    document.getElementById("dateTime").innerText = new Date().toLocaleString();
}

loadItems();
updateDateTime();
setInterval(updateDateTime,1000);

</script>

</body>
</html>
